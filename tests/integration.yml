---
- name: Setup Integration Environment
  import_playbook: infra/setup.yml
  tags: [always, setup]

- name: Run Integration Tests
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    target_remote: test-infra
  tasks:
    - name: Test incus_image
      import_tasks: integration/targets/incus_image/tasks/main.yml
      tags: [incus_image]

    - name: Test incus_publish
      import_tasks: integration/targets/incus_publish/tasks/main.yml
      tags: [incus_publish]

    - name: Test incus_storage
      import_tasks: integration/targets/incus_storage/tasks/main.yml
      tags: [incus_storage]

    - name: Test incus_profile
      import_tasks: integration/targets/incus_profile/tasks/main.yml
      tags: [incus_profile]

    - name: Test incus_project
      import_tasks: integration/targets/incus_project/tasks/main.yml
      tags: [incus_project]

    - name: Test incus_instance
      import_tasks: integration/targets/incus_instance/tasks/main.yml
      tags: [incus_instance]

    - name: Test incus_config
      import_tasks: integration/targets/incus_config/tasks/main.yml
      tags: [incus_config]

    - name: Test incus_exec
      import_tasks: integration/targets/incus_exec/tasks/main.yml
      tags: [incus_exec]

    - name: Test incus_file
      import_tasks: integration/targets/incus_file/tasks/main.yml
      tags: [incus_file]

    - name: Test incus_snapshot
      import_tasks: integration/targets/incus_snapshot/tasks/main.yml
      tags: [incus_snapshot]

    - name: Test incus_inventory
      import_tasks: integration/targets/incus_inventory/tasks/main.yml
      tags: [incus_inventory]

    - name: Test incus_export
      import_tasks: integration/targets/incus_export/tasks/main.yml
      tags: [incus_export]

    - name: Test incus_list
      import_tasks: integration/targets/incus_list/tasks/main.yml
      tags: [incus_list]

    - name: Test incus_instance_cloud_init
      import_tasks: integration/targets/incus_instance_cloud_init/tasks/main.yml
      tags: [incus_instance_cloud_init]

    - name: Test incus_remote
      import_tasks: integration/targets/incus_remote/tasks/main.yml
      tags: [incus_remote]

    - name: Test incus_network
      import_tasks: integration/targets/incus_network/tasks/main.yml
      tags: [incus_network]

    - name: Test incus_lookup
      import_tasks: integration/targets/incus_lookup/tasks/main.yml
      tags: [incus_lookup]

    - name: Test incus_info
      import_tasks: integration/targets/incus_info/tasks/main.yml
      tags: [incus_info]

    - name: Test incus_admin_init
      import_tasks: integration/targets/incus_admin_init/tasks/main.yml
      tags: [incus_admin_init]

    - name: Test incus_cluster
      import_tasks: integration/targets/incus_cluster/tasks/main.yml
      tags: [incus_cluster]
